{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "../../App.svelte"
  ],
  "sourcesContent": [
    "<script>\n//  import ace from 'brace'\n//  console.log('ace', ace)\n\n  // ace NOV\n//\n  window.document.domain = \"evolvitcms.com\";\n  import ace from '../ace-builds-master/src-noconflict/ace.js'\n\n  import { onMount, tick } from 'svelte';\n\n  function fetch2(url, obj){\n  //    var body = JSON.stringify(obj);\n    //console.log('fetch', this)\n    // TODO: Zamijeni ovo sranje s necim boljim\n    var body = new FormData()\n    if (obj)\n        Object.keys(obj).forEach(function(key) {\n          var tmpObj = obj[key]===null?'':obj[key]\n          if (typeof tmpObj == 'object') tmpObj=JSON.stringify(tmpObj)\n          body.append(key, tmpObj)\n        });\n//    if (self) self.set('loading', true)\n    \n    return new Promise(function(resolve, reject) {\n      var response = fetch('../cms/'+'api.php', {\n          method: 'post',\n          credentials:'same-origin',\n  //            headers: {\n  //             'Accept': 'application/json',\n            'Content-Type': 'application/json',\n  //              \"authorization\":'Bearer '+ authorization\n  //            },\n          body: body\n        }).then(function(response){ \n//              if (self) self.set('loading', false)\n              return response.json()\n          })\n        .then(function(j){ \n            //console.log('j',j); \n            if (j && j._message_action == \"reload\")  ractive.set('is_logedin',false)//document.location = document.location; // missing session\n            resolve([j,null]) \n          })\n        .catch(function(err){\n//            if (self) self.set('loading', false)\n            console.log('nework error!', err);\n            //izitoast.error({ message: 'Network error!!!'});\n            resolve([null,err])\n        })\n      })\n  }\n/*\n  async function testf(){\n    var [resp,err] = await fetch2('twigs', {query:'Twigs', id: \"2\"})\n    console.log('resp', resp)\n  }\n\n  console.log('!!!!!!')\n  testf()\n*/\n  let grid_el\n  let editor\n  let site_preview_url = window.location.hash.slice(1) \n  $: if (site_preview_url) window.location.hash = site_preview_url \n  let view_generated_source_promise\n  $: if (site_preview_url && view_generated_source) \n    view_generated_source_promise = fetch('../'+site_preview_url).then((r)=>r.text())\n\n  let files = []\n  let files_map = {}\n  let selected_file_name = site_preview_url + '.twig'\n  let editor_value_changed = false\n  let m = { x: 400, y: 300, state:'' };\n  let view_generated_source=false\n  $: userSelect = m.state?'none':'auto' //user-select: none\n  $: {\n    if (!m.state && document.getElementById('sitePreview'))\n      document.getElementById('sitePreview').style.pointerEvents='auto'\n    if (!m.state && document.getElementById('adminPreview'))\n      document.getElementById('adminPreview').style.pointerEvents='auto'\n      \n    if (m.state && document.getElementById('sitePreview'))\n      document.getElementById('sitePreview').style.pointerEvents='none'\n    if (m.state && document.getElementById('adminPreview'))\n      document.getElementById('adminPreview').style.pointerEvents='none'\n  }\n\n  $: if (!m.state){\n    console.log('resize');\n    if (editor) editor.resize(true);\n  }\n\n\n\tfunction handleMousemove(event) {\n    if (event.buttons === 0) return\n\n//document.body.clientWidth/2 \n//document.body.clientHeight/2\n\t\tif (m.state == 'downH' || m.state == 'down') m.x = event.clientX / document.body.clientWidth ;\n\t\tif (m.state == 'downV' || m.state == 'down') m.y = event.clientY / document.body.clientHeight ;\n  }\n\n\tfunction selectFile(file, ix) {\n    selected_file_name = file.name\n    editor.setValue(file.html);\n    editor.scrollToLine(0, true, true, function () {});\n    let name_arr = selected_file_name.split('.')\n    name_arr.pop();\n    let trimmed_name = name_arr.join('.')\n    //console.log(file, ix, trimmed_name)\n    site_preview_url = trimmed_name\n  }\n\n  async function save_twig_template(){\n    var [resp,err] = await fetch2('twigs', {\n      query:'Twigs', \n      _action:'update', \n      ...files_map[selected_file_name], \n      html: editor.getValue()\n    })\n    if (document.getElementById('sitePreview')) {\n      //document.getElementById('sitePreview').contentWindow.location.reload()\n      let tmp = site_preview_url; \n      site_preview_url=''; \n      tick().then(e=>site_preview_url = tmp)  \n    }\n    else \n      view_generated_source_promise = fetch('../'+site_preview_url).then((r)=>r.text())\n\n    if (!err) await fetch_file_list()\n    editor.focus();\n    \n  }\n  \n  let postMsg\n\tonMount( async() => {\n    //document.getElementById('sitePreview').contentWindow.document.domain = \"evolvitcms.com\";\n\n\n    postMsg = window.document.getElementById('headerFrameEl').contentWindow.postMessage\n    let __seq = 0\n    function postMessagePromise(msg){\n      return new Promise(function(resolve, reject) {\n        let seq = ++__seq;\n\n        let event_ref = window.addEventListener(\"message\", function(resp){\n          if (resp && resp.data && resp.data.__seq && resp.data.__seq == seq){\n            window.removeEventListener(\"message\", event_ref)\n            resolve(resp.data)\n          }\n        }, false);\n\n        postMsg({...msg, __seq:seq}, 'http://evolvitcms.com/googleauthframe')\n      });\n    }\n    window.postMessagePromise = postMessagePromise\n    window.postMsg = postMsg\n\n    // test\n    setTimeout(function(){\n      postMessagePromise({namespace:'PlaygroundProjectsAdd'})\n      .then((r)=>{ console.log('JEEE', r) })\n    }, 6000)\n\n\n    //console.log(grid_el, grid_el.clientWidth, document.body.clientWidth, grid_el.clientWidth/2 && document.body.clientWidth/2)\n    window.grid_el = grid_el\n\n    m.x = 0.5 ;\n    m.y = 0.5 ;\n\n//    m.x = grid_el.clientWidth/2 && document.body.clientWidth/2 ;\n//    m.y = grid_el.clientHeight/2 && document.body.clientHeight/2;\n    await showPromise;\n    show = true\n    await tick();\n\n    ace.config.set('basePath', 'ace-builds-master/src-noconflict/')\n    editor = ace.edit(\"editor\");\n    editor.setTheme(\"ace/theme/monokai\");\n    editor.session.setMode(\"ace/mode/twig\");\n    editor.commands.addCommand({\n        name: 'Save',\n        bindKey: {win: 'Ctrl-S',  mac: 'Command-S'},\n        exec: function(editor) {\n            save_twig_template()\n        },\n        readOnly: false\n    });    \n    editor.session.setOptions({\n      //mode: \"ace/mode/javascript\",\n      tabSize: 2,\n      useSoftTabs: true\n    });\n    //editor.session.setMode(\"ace/mode/javascript\");\n    //var [resp,err] = await fetch2('twigs', {query:'Twigs', id: \"2\"})\n    //editor.setValue(resp[0].html);\n    await fetch_file_list()\n    editor.scrollToLine(0, true, true, function () {});\n\n    editor.session.on('change', function(delta) {\n      if (!selected_file_name || !files_map || !files_map[selected_file_name]) return\n      editor_value_changed = (editor.getValue() != files_map[selected_file_name].html)\n    });    \n\t});  \n\n  async function fetch_file_list(){\n    var [resp,err] = await fetch2('twigs', {query:'Twigs'})\n    files_map = resp.reduce(function(r, e) {\n      r[e.name] = e;\n      return r;\n    }, {});\n    files = resp\n    if (!selected_file_name || !files_map || !files_map[selected_file_name]) return\n    \n    if (editor.getValue() != files_map[selected_file_name].html){\n      editor.setValue(files_map[selected_file_name].html);    \n      editor.resize(true);\n    }\n\n  }\n\n  async function addNewFile(){\n    let newFileName = prompt('Enter file name:')\n    if (!newFileName) return\n    if (!newFileName.endsWith('.twig'))\n      newFileName = newFileName + '.twig';\n    \n    var [resp,err] = await fetch2('twigs', {\n      query:'Twigs', \n      _action:'insert', \n      name: newFileName, \n      html: ''\n    })\n    if (!err) await fetch_file_list()\n    selected_file_name = newFileName\n    selectFile(files_map[selected_file_name])\n//    document.getElementById('sitePreview').contentWindow.location.reload()\n    \n    //files = [{id:'', name:'novi.twig', html:'prazno'}, ...files]\n  }\n  async function removeFile(file){\n    let conf = confirm(`Remove file '${file.name}'?`)\n    if (!conf) return\n\n    var [resp,err] = await fetch2('twigs', {\n      query:'Twigs', \n      _action:'delete', \n      ...file\n    })\n    if (!err) await fetch_file_list()\n    selected_file_name = null\n    //selectFile(files_map[selected_file_name])\n  }\n\n\n\n\n\n  let headerFrameEl\n  let isSignedIn\n  let email\n  let show = false\n  let showResolve\n  let showPromise = new Promise(function(resolve, reject){\n    showResolve = resolve\n  })\n\n  let firstLogin = true\n  window.onmessage = function(e){\n    console.log('onmessage u plejgroundu', e)\n    if (e && e.data && e.data.namespace=='signin'){\n      isSignedIn = e.data.data.isSignedIn\n      email = e.data.data.email\n      if (firstLogin) showResolve()\n      firstLogin = false\n    }\n\n  };\n  function signin(){\n      postMessagePromise({namespace:'gapi.auth2.getAuthInstance().signIn()'})\n      .then((r)=>{ \n        console.log('JEEE', r) \n        isSignedIn = true\n        email = r.email\n      })    \n  }\n  let showProjectList = false\n</script>\n<style>\n\tgrid {\n\t\tbox-sizing: content-box;\n\t\tdisplay: grid;\n\t\twidth:100%;\n\t\theight:calc(100vh - 40px);\n\t\tgrid-template-columns: var(--mx, auto) 5px auto;\n  \tgrid-template-rows: var(--my, auto) 5px auto;\n  \tgrid-template-areas: \n    \"d1  vd1 d2 \"\n    \"hd1 hdc d2\"\n    \"d3  vd2 d2\";\n\t}\n\t.d1 {\n\t\tgrid-area: d1;\n    overflow: auto;\n\t}\n\t.d2 {\n\t\tgrid-area: d2;\n    overflow: auto;\n\t}\n\t.d3 {\n\t\tgrid-area: d3;\n    overflow: auto;\n\t}\n\t.d4 {\n\t\tgrid-area: d4;\n    overflow: auto;\n\t}\n\t.vd1 {\n\t\tgrid-area: vd1;\n\t\tbackground-color:black;\n\t\tcursor: col-resize;\n\t}\t\n\t.vd2 {\n\t\tgrid-area: vd2;\n\t\tbackground-color:black;\n\t\tcursor: col-resize;\n\t}\t\n\t.hd1 {\n\t\tgrid-area: hd1;\n\t\tbackground-color:black;\n\t\tcursor: row-resize;\n\t}\t\n  /*\n\t.hd2 {\n\t\tgrid-area: hd2;\n\t\tbackground-color:black;\n\t\tcursor: row-resize;\n\t}\t\n  */\t\n\t.hdc {\n\t\tgrid-area: hdc;\n\t\tbackground-color:black;\n\t\tcursor: move;\n\t}\t\n  .remove-btn{\n    visibility: hidden;\n  }\n  .list-group-item:hover .remove-btn{\n    visibility: visible;\n  }\n</style>\n<window on:mouseup|capture={()=> { if(m.state) m.state = '' } }/>\n\n\n<div style=\"display:flex; justify-content: flex-end; height: 40px;\">\n  <input type=\"text\" class=\"form-control\" placeholder=\"Title\">\n\n  <div class=\"dropdown\" class:show={showProjectList}>\n    <button class=\"btn btn-secondary dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"{showProjectList}\">\n      Your saved Projects\n    </button>\n    <div class=\"dropdown-menu\" class:show={showProjectList} aria-labelledby=\"dropdownMenuButton\">\n      <a class=\"dropdown-item\" href=\"#\">Action</a>\n      <a class=\"dropdown-item\" href=\"#\">Another action</a>\n      <a class=\"dropdown-item\" href=\"#\">Something else here</a>\n    </div>\n  </div>\n\n\n  <button on:click={ signin } disabled={!isSignedIn}\n  class=\"btn btn-outline-secondary\" type=\"button\"\n  title={isSignedIn?'':'Sign in to save'}>\n    {isSignedIn?'Save Project ':'Sign in to save'}\n  </button>\n  <!-- <span>{email}</span> -->\n  <iframe  bind:this={headerFrameEl} id=\"headerFrameEl\" title=\"Header\" src=\"http://evolvitcms.com/googleauthframe\" frameBorder=\"0\" width=\"125px\" height=\"40px\">\n  </iframe>\n\n</div>\n{#await showPromise}\n<div style=\"text-align:center; padding-top:4rem\"><p>Loading...</p></div>\n{:then}\n  <grid bind:this={grid_el} on:mousemove={handleMousemove} on:mouseup={()=> { if(m.state) m.state = '' } }\n        style=\"--mx:{100*m.x}%; --my:{100*m.y}%; user-select:{userSelect}\">\n    <div class=\"vd1\" on:mousedown={()=> m.state = 'downH'}></div>\n    <div class=\"vd2\" on:mousedown={()=> m.state = 'downH'}></div>\n    <div class=\"hd1\" on:mousedown={()=> m.state = 'downV'}></div>\n    <!--\n    <div class=\"hd2\" on:mousedown={()=> m.state = 'downV'}></div>\n    -->\n    <div class=\"hdc\" on:mousedown={()=> { m.state = 'down'}}></div>\n    <div class=\"d1\">\n      <iframe  id=\"adminPreview\" title=\"Admin\" src=\"../cms/admin/index.html\" frameBorder=\"0\" width=\"100%\" height=\"100%\">\n      </iframe>\n    </div>\n\n    <div class=\"d2\" style=\"overflow: auto;display: flex; flex-flow: column;\">\n      <div style=\"height: 3.75rem;; margin:0; color:white; background-color:#203554; padding-left:1rem; display: flex;align-items: center;justify-content: space-between;\">\n        <div>\n          <img src=\"bulb.png\" alt=\"buld\" style=\"margin-right: 0.5rem;\">\n          <span>Preview</span>\n        </div>\n        <div style=\"display:flex\">\n\n          <div on:click={()=> view_generated_source=false}\n          style=\"border-bottom-width: 4px; cursor: pointer;\n            border-bottom-style: {!view_generated_source?'solid':'hidden'};\n            border-bottom-color: white;\n            padding: 0.5rem;\n            margin: 0.5rem;\">\n            <img src=\"prev_browser.png\" alt=\"browser\" style=\"margin-right:0.5rem\">\n            Browser\n          </div>\n\n          <div on:click={()=> view_generated_source=true}\n          style=\"border-bottom-width: 4px; cursor: pointer;\n            border-bottom-style: {view_generated_source?'solid':'hidden'};\n            border-bottom-color: white;\n            padding: 0.5rem;\n            margin: 0.5rem;\">\n            <img src=\"prev_source.png\" alt=\"browser\" style=\"margin-right:0.5rem\">\n            Generated source\n          </div>\n\n        </div>\n      </div>\n      <div class=\"input-group\">\n        <input bind:value=\"{site_preview_url}\" type=\"text\" class=\"form-control\" placeholder=\"url\" aria-label=\"url\" aria-describedby=\"basic-addon2\">\n        <div class=\"input-group-append\">\n        <!--\n          <button on:click={()=> document.getElementById('sitePreview').contentWindow.location.reload() } \n            class=\"btn btn-outline-secondary\" type=\"button\">\n            <span class=\"oi oi-loop-circular\" title=\"Refresh\" aria-hidden=\"true\"></span>\n          </button>\n          -->\n          <button on:click={()=> {let tmp = site_preview_url; site_preview_url=''; tick().then(e=>site_preview_url = tmp)  } } \n            class=\"btn btn-outline-secondary\" type=\"button\">\n            <span class=\"oi oi-loop-circular\" title=\"Refresh\" aria-hidden=\"true\"></span>\n          </button>\n          <a class=\"btn btn-outline-secondary\" href=\"../{site_preview_url}\" target=\"_blank\" role=\"button\">\n          <span class=\"oi oi-external-link\" title=\"Open in new tab\" aria-hidden=\"true\"></span>\n          </a>\n        </div>\n      </div>\n\n      {#if view_generated_source }\n      <pre style=\"flex:1; tab-size: 2;\">\n      <code>\n        {#await view_generated_source_promise}\n          <!-- promise is pending -->\n          <p>loading...</p>\n        {:then value}\n          <!-- promise was fulfilled -->\n          {value}\n        {:catch error}\n          <!-- promise was rejected -->\n          <p>Something went wrong: {error.message}</p>\n        {/await}\n      </code>\n      </pre>\n      {:else}\n      <iframe style=\"flex:1\" id=\"sitePreview\" title=\"Site Preview\" src=\"../{site_preview_url}\" frameBorder=\"0\" width=\"100%\" height=\"100%\">\n      </iframe>\n      {/if }\n    </div>\n\n\n    <div class=\"d3\" style=\"overflow: auto;display: flex; flex-flow: column;\">\n\n      <div style=\"margin:0; color:white; background-color:#203554; padding-left:1rem; display: flex;align-items: center;justify-content: space-between;\">\n        <span>\n          <img src=\"bulb.png\" style=\"margin-right: 0.5rem;\" alt=\"buld\">\n          HTML/Twig Code Editor \n        </span> \n        \n      <button on:click={save_twig_template} disabled={!editor_value_changed} style=\"float:right\" class=\"btn btn-outline-secondary\" type=\"button\">\n        <span class=\"oi oi-check\"></span> Save\n      </button>\n        \n      </div>\n\n      <div style=\"overflow: auto;display: flex; flex-flow: row; flex:1\">\n        <div class=\"list-group\" style=\"overflow:auto\">\n            <a href=\"javascript:void(0)\" on:click={addNewFile} \n            class=\"list-group-item list-group-item-action list-group-item-light\">\n              \n              <strong><span class=\"oi oi-plus\"></span> Add new file</strong>\n            </a>\n\n          {#each files as file, ix}\n            <a href=\"javascript:void(0)\" on:click={()=> selectFile(file, ix)}\n            style=\"padding-right: 0.5rem;\" \n            class=\"list-group-item list-group-item-action list-group-item-light {file.name==selected_file_name?'active':''}\">\n              {file.name}\n                <span on:click|stopPropagation={ ()=> removeFile(file) }\n                  style=\"float: right; padding: 0.1rem;\" \n                  class=\"oi oi-x remove-btn\" \n                  title=\"Delete file\" \n                  aria-hidden=\"true\">\n                </span> \n            </a>\n          {/each}\n        </div>  \n        <div id=\"editor\" style=\"width:100%; height:100%; flex:1;\">\n        </div>\n      </div>  \n\n    </div>\n    <!--\n    <div class=\"d4\">\n      <h2>Kako napraviti Testimonials sekciju</h2>\n      <p>Detaljno objasnjenje...<br>.....\n      </p>\n    </div>\n    -->\n  </grid>\n  {/await}\n<!--\nm.x = {m.x} px; m.y = {m.y} px\nm.state = {m.state}\n-->\n"
  ],
  "names": [],
  "mappings": "AAkSC,IAAI,8BAAC,CAAC,AACL,UAAU,CAAE,WAAW,CACvB,OAAO,CAAE,IAAI,CACb,MAAM,IAAI,CACV,OAAO,KAAK,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,CACzB,qBAAqB,CAAE,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,IAAI,CAC9C,kBAAkB,CAAE,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,IAAI,CAC5C,mBAAmB,CAClB,aAAa;IACb,YAAY;IACZ,YAAY,AACf,CAAC,AACD,GAAG,8BAAC,CAAC,AACJ,SAAS,CAAE,EAAE,CACX,QAAQ,CAAE,IAAI,AACjB,CAAC,AACD,GAAG,8BAAC,CAAC,AACJ,SAAS,CAAE,EAAE,CACX,QAAQ,CAAE,IAAI,AACjB,CAAC,AACD,GAAG,8BAAC,CAAC,AACJ,SAAS,CAAE,EAAE,CACX,QAAQ,CAAE,IAAI,AACjB,CAAC,AAKD,IAAI,8BAAC,CAAC,AACL,SAAS,CAAE,GAAG,CACd,iBAAiB,KAAK,CACtB,MAAM,CAAE,UAAU,AACnB,CAAC,AACD,IAAI,8BAAC,CAAC,AACL,SAAS,CAAE,GAAG,CACd,iBAAiB,KAAK,CACtB,MAAM,CAAE,UAAU,AACnB,CAAC,AACD,IAAI,8BAAC,CAAC,AACL,SAAS,CAAE,GAAG,CACd,iBAAiB,KAAK,CACtB,MAAM,CAAE,UAAU,AACnB,CAAC,AAQD,IAAI,8BAAC,CAAC,AACL,SAAS,CAAE,GAAG,CACd,iBAAiB,KAAK,CACtB,MAAM,CAAE,IAAI,AACb,CAAC,AACA,yCAAW,CAAC,AACV,UAAU,CAAE,MAAM,AACpB,CAAC,AACD,+BAAgB,MAAM,CAAC,0BAAW,CAAC,AACjC,UAAU,CAAE,OAAO,AACrB,CAAC"
}