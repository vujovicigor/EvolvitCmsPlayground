{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "../../App.svelte"
  ],
  "sourcesContent": [
    "<script>\n//  import ace from 'brace'\n//  console.log('ace', ace)\n\n  // ace NOV\n//\n  import ace from '../ace-builds-master/src-noconflict/ace.js'\n\n  import { onMount } from 'svelte';\n\n  function fetch2(url, obj){\n  //    var body = JSON.stringify(obj);\n    //console.log('fetch', this)\n    // TODO: Zamijeni ovo sranje s necim boljim\n    var body = new FormData()\n    if (obj)\n        Object.keys(obj).forEach(function(key) {\n          var tmpObj = obj[key]===null?'':obj[key]\n          if (typeof tmpObj == 'object') tmpObj=JSON.stringify(tmpObj)\n          body.append(key, tmpObj)\n        });\n//    if (self) self.set('loading', true)\n    \n    return new Promise(function(resolve, reject) {\n      var response = fetch('../cms/'+'api.php', {\n          method: 'post',\n          credentials:'same-origin',\n  //            headers: {\n  //             'Accept': 'application/json',\n            'Content-Type': 'application/json',\n  //              \"authorization\":'Bearer '+ authorization\n  //            },\n          body: body\n        }).then(function(response){ \n//              if (self) self.set('loading', false)\n              return response.json()\n          })\n        .then(function(j){ \n            //console.log('j',j); \n            if (j && j._message_action == \"reload\")  ractive.set('is_logedin',false)//document.location = document.location; // missing session\n            resolve([j,null]) \n          })\n        .catch(function(err){\n//            if (self) self.set('loading', false)\n            console.log('nework error!', err);\n            //izitoast.error({ message: 'Network error!!!'});\n            resolve([null,err])\n        })\n      })\n  }\n/*\n  async function testf(){\n    var [resp,err] = await fetch2('twigs', {query:'Twigs', id: \"2\"})\n    console.log('resp', resp)\n  }\n\n  console.log('!!!!!!')\n  testf()\n*/\n  let grid_el\n  let editor\n  let site_preview_url = window.location.hash.slice(1) \n  $: if (site_preview_url) window.location.hash = site_preview_url \n  let files = []\n  let files_map = {}\n  let selected_file_name = site_preview_url + '.twig'\n  let editor_value_changed = false\n  let m = { x: 400, y: 300, state:'' };\n  $: userSelect = m.state?'none':'auto' //user-select: none\n  $: {\n    if (!m.state && document.getElementById('sitePreview'))\n      document.getElementById('sitePreview').style.pointerEvents='auto'\n    if (!m.state && document.getElementById('adminPreview'))\n      document.getElementById('adminPreview').style.pointerEvents='auto'\n      \n    if (m.state && document.getElementById('sitePreview'))\n      document.getElementById('sitePreview').style.pointerEvents='none'\n    if (m.state && document.getElementById('adminPreview'))\n      document.getElementById('adminPreview').style.pointerEvents='none'\n  }\n\n  $: if (!m.state){\n    console.log('resize');\n    if (editor) editor.resize(true);\n  }\n\n\n\tfunction handleMousemove(event) {\n    if (event.buttons === 0) return\n\t\tif (m.state == 'downH' || m.state == 'down') m.x = event.clientX;\n\t\tif (m.state == 'downV' || m.state == 'down') m.y = event.clientY;\n  }\n\n\tfunction selectFile(file, ix) {\n    selected_file_name = file.name\n    editor.setValue(file.html);\n    editor.scrollToLine(0, true, true, function () {});\n    let name_arr = selected_file_name.split('.')\n    name_arr.pop();\n    let trimmed_name = name_arr.join('.')\n    //console.log(file, ix, trimmed_name)\n    site_preview_url = trimmed_name\n  }\n\n  async function save_twig_template(){\n    var [resp,err] = await fetch2('twigs', {\n      query:'Twigs', \n      _action:'update', \n      ...files_map[selected_file_name], \n      html: editor.getValue()\n    })\n    document.getElementById('sitePreview').contentWindow.location.reload()\n    if (!err) await fetch_file_list()\n    editor.focus();\n    \n  }\n  \n\tonMount( async() => {\n    console.log(grid_el, grid_el.clientWidth, document.body.clientWidth, grid_el.clientWidth/2 && document.body.clientWidth/2)\n    window.grid_el = grid_el\n\n    m.x = grid_el.clientWidth/2 && document.body.clientWidth/2 ;\n    m.y = grid_el.clientHeight/2 && document.body.clientHeight/2;\n\n    ace.config.set('basePath', 'ace-builds-master/src-noconflict/')\n    editor = ace.edit(\"editor\");\n    editor.setTheme(\"ace/theme/monokai\");\n    editor.session.setMode(\"ace/mode/twig\");\n    editor.commands.addCommand({\n        name: 'Save',\n        bindKey: {win: 'Ctrl-S',  mac: 'Command-S'},\n        exec: function(editor) {\n            save_twig_template()\n        },\n        readOnly: false\n    });    \n    //editor.session.setMode(\"ace/mode/javascript\");\n    //var [resp,err] = await fetch2('twigs', {query:'Twigs', id: \"2\"})\n    //editor.setValue(resp[0].html);\n    await fetch_file_list()\n    editor.scrollToLine(0, true, true, function () {});\n\n    editor.session.on('change', function(delta) {\n      if (!selected_file_name || !files_map || !files_map[selected_file_name]) return\n      editor_value_changed = (editor.getValue() != files_map[selected_file_name].html)\n    });    \n\t});  \n\n  async function fetch_file_list(){\n    var [resp,err] = await fetch2('twigs', {query:'Twigs'})\n    files_map = resp.reduce(function(r, e) {\n      r[e.name] = e;\n      return r;\n    }, {});\n    files = resp\n    if (!selected_file_name || !files_map || !files_map[selected_file_name]) return\n    \n    if (editor.getValue() != files_map[selected_file_name].html){\n      editor.setValue(files_map[selected_file_name].html);    \n      editor.resize(true);\n    }\n\n  }\n\n  async function addNewFile(){\n    let newFileName = prompt('Enter file name:')\n    // todo: force .twig extensin \n    if (!newFileName) return\n\n    var [resp,err] = await fetch2('twigs', {\n      query:'Twigs', \n      _action:'insert', \n      name: newFileName, \n      html: ''\n    })\n    if (!err) await fetch_file_list()\n    selected_file_name = newFileName\n    selectFile(files_map[selected_file_name])\n//    document.getElementById('sitePreview').contentWindow.location.reload()\n    \n    //files = [{id:'', name:'novi.twig', html:'prazno'}, ...files]\n  }\n</script>\n<style>\n\tgrid {\n\t\tbox-sizing: content-box;\n\t\tdisplay: grid;\n\t\twidth:100%;\n\t\theight:100vh;\n\t\tgrid-template-columns: var(--mx, auto) 5px auto;\n  \tgrid-template-rows: var(--my, auto) 5px auto;\n  \tgrid-template-areas: \n    \"d1  vd1 d2 \"\n    \"hd1 hdc d2\"\n    \"d3  vd2 d2\";\n\t}\n\t.d1 {\n\t\tgrid-area: d1;\n    overflow: auto;\n\t}\n\t.d2 {\n\t\tgrid-area: d2;\n    overflow: auto;\n\t}\n\t.d3 {\n\t\tgrid-area: d3;\n    overflow: auto;\n\t}\n\t.d4 {\n\t\tgrid-area: d4;\n    overflow: auto;\n\t}\n\t.vd1 {\n\t\tgrid-area: vd1;\n\t\tbackground-color:black;\n\t\tcursor: col-resize;\n\t}\t\n\t.vd2 {\n\t\tgrid-area: vd2;\n\t\tbackground-color:black;\n\t\tcursor: col-resize;\n\t}\t\n\t.hd1 {\n\t\tgrid-area: hd1;\n\t\tbackground-color:black;\n\t\tcursor: row-resize;\n\t}\t\n  /*\n\t.hd2 {\n\t\tgrid-area: hd2;\n\t\tbackground-color:black;\n\t\tcursor: row-resize;\n\t}\t\n  */\t\n\t.hdc {\n\t\tgrid-area: hdc;\n\t\tbackground-color:black;\n\t\tcursor: move;\n\t}\t\n</style>\n<window on:mouseup|capture={()=> { if(m.state) m.state = '' } }/>\n<grid bind:this={grid_el} on:mousemove={handleMousemove} on:mouseup={()=> { if(m.state) m.state = '' } }\n\t\t\tstyle=\"--mx:{m.x}px; --my:{m.y}px; user-select:{userSelect}\">\n\t<div class=\"vd1\" on:mousedown={()=> m.state = 'downH'}></div>\n\t<div class=\"vd2\" on:mousedown={()=> m.state = 'downH'}></div>\n\t<div class=\"hd1\" on:mousedown={()=> m.state = 'downV'}></div>\n  <!--\n\t<div class=\"hd2\" on:mousedown={()=> m.state = 'downV'}></div>\n  -->\n\t<div class=\"hdc\" on:mousedown={()=> { m.state = 'down'}}></div>\n\t<div class=\"d1\">\n    <iframe  id=\"adminPreview\" title=\"Admin\" src=\"../cms/admin/index.html\" frameBorder=\"0\" width=\"100%\" height=\"100%\">\n    </iframe>\n  </div>\n\t<div class=\"d2\" style=\"overflow: auto;display: flex; flex-flow: column;\">\n    <div class=\"input-group\">\n      <input bind:value=\"{site_preview_url}\" type=\"text\" class=\"form-control\" placeholder=\"url\" aria-label=\"url\" aria-describedby=\"basic-addon2\">\n      <div class=\"input-group-append\">\n        <button on:click={()=> document.getElementById('sitePreview').contentWindow.location.reload() } \n        class=\"btn btn-outline-secondary\" type=\"button\">\n        <span class=\"oi oi-loop-circular\" title=\"Refresh\" aria-hidden=\"true\"></span>\n        </button>\n        <a class=\"btn btn-outline-secondary\" href=\"../{site_preview_url}\" target=\"_blank\" role=\"button\">\n        <span class=\"oi oi-external-link\" title=\"Open in new tab\" aria-hidden=\"true\"></span>\n        </a>\n      </div>\n    </div>\n\n    <iframe id=\"sitePreview\" title=\"Site Preview\" src=\"../{site_preview_url}\" frameBorder=\"0\" width=\"100%\" height=\"100%\">\n    </iframe>\n  </div>\n\t<div class=\"d3\" style=\"overflow: auto;display: flex; flex-flow: column;\">\n\n    <div style=\"margin:0; color:white; background-color:#2F3129\">\n      HTML/Twig Code Editor  \n      \n    <button on:click={save_twig_template} disabled={!editor_value_changed} style=\"float:right\" class=\"btn btn-outline-secondary\" type=\"button\">\n      <span class=\"oi oi-check\"></span> Save\n    </button>\n      \n    </div>\n\n    <div style=\"overflow: auto;display: flex; flex-flow: row; flex:1\">\n      <div class=\"list-group\" style=\"overflow:auto\">\n          <a href=\"javascript:void(0)\" on:click={addNewFile} \n          class=\"list-group-item list-group-item-action list-group-item-light\">\n            \n            <strong><span class=\"oi oi-plus\"></span> Add new file</strong>\n          </a>\n\n        {#each files as file, ix}\n          <a href=\"javascript:void(0)\" on:click={()=> selectFile(file, ix)} \n          class=\"list-group-item list-group-item-action list-group-item-light {file.name==selected_file_name?'active':''}\">\n            {file.name}\n          </a>\n        {/each}\n      </div>  \n      <div id=\"editor\" style=\"width:100%; height:100%; flex:1;\">\n      </div>\n    </div>  \n\n  </div>\n  <!--\n\t<div class=\"d4\">\n    <h2>Kako napraviti Testimonials sekciju</h2>\n    <p>Detaljno objasnjenje...<br>.....\n    </p>\n  </div>\n  -->\n</grid>\n<!--\nm.x = {m.x} px; m.y = {m.y} px\nm.state = {m.state}\n-->\n"
  ],
  "names": [],
  "mappings": "AAwLC,IAAI,eAAC,CAAC,AACL,UAAU,CAAE,WAAW,CACvB,OAAO,CAAE,IAAI,CACb,MAAM,IAAI,CACV,OAAO,KAAK,CACZ,qBAAqB,CAAE,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,IAAI,CAC9C,kBAAkB,CAAE,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,IAAI,CAC5C,mBAAmB,CAClB,aAAa;IACb,YAAY;IACZ,YAAY,AACf,CAAC,AACD,GAAG,eAAC,CAAC,AACJ,SAAS,CAAE,EAAE,CACX,QAAQ,CAAE,IAAI,AACjB,CAAC,AACD,GAAG,eAAC,CAAC,AACJ,SAAS,CAAE,EAAE,CACX,QAAQ,CAAE,IAAI,AACjB,CAAC,AACD,GAAG,eAAC,CAAC,AACJ,SAAS,CAAE,EAAE,CACX,QAAQ,CAAE,IAAI,AACjB,CAAC,AAKD,IAAI,eAAC,CAAC,AACL,SAAS,CAAE,GAAG,CACd,iBAAiB,KAAK,CACtB,MAAM,CAAE,UAAU,AACnB,CAAC,AACD,IAAI,eAAC,CAAC,AACL,SAAS,CAAE,GAAG,CACd,iBAAiB,KAAK,CACtB,MAAM,CAAE,UAAU,AACnB,CAAC,AACD,IAAI,eAAC,CAAC,AACL,SAAS,CAAE,GAAG,CACd,iBAAiB,KAAK,CACtB,MAAM,CAAE,UAAU,AACnB,CAAC,AAQD,IAAI,eAAC,CAAC,AACL,SAAS,CAAE,GAAG,CACd,iBAAiB,KAAK,CACtB,MAAM,CAAE,IAAI,AACb,CAAC"
}